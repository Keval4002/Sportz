<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Websockets Demo</title>
    <style>
        body { font-family: sans-serif; padding: 20px; background: #121212; color: #fff;}
        #log {background: #000; padding: 10px; height: 300px; overflow-y: scroll; border: 1px solid #333;}
        .status-on {color: #00ff00;}
        .status-off {color: #ff0000;}
    </style>
</head>
<body>
    <h1>Websockets Broadcast Console</h1>
    <p id="status" class="status-off">Connecting ....</p>

    <form id="message-form">
        <input type="text" id="message-input" placeholder="Send Message" required>
        <button type="submit">Deploy Message</button>
    </form>

    <h3>Live Stream Logs: </h3>
    <pre id="log"></pre>
</body>

<script>
    const statusEl = document.getElementById("status");
    const log = document.getElementById("log");
    const input = document.getElementById("message-input");

    //initiate socket handshake
    const socket = new WebSocket('ws://localhost:8080');

    const appendLog = (label, message)=>{
        const entry =  `${new Date().toLocaleDateString()} ${label} ${message}\n`
        log.textContent = entry + log.textContent;
    }

    socket.addEventListener('open', ()=>{
        statusEl.textContent = 'Connected: ws://localhost:8080';
        statusEl.className = 'status-on';
        appendLog('[System]', 'Tunnel established');
    })

    socket.addEventListener('close', ()=>{
        statusEl.textContent = 'Disconnected: ws://localhost:8080';
        statusEl.className = 'status-off';
        appendLog('[System]', 'Tunnel closed');

    })

    socket.addEventListener('message', (e)=>{
        appendLog('[Server Sent]', e.data);
    })

    document.getElementById('message-form').addEventListener('submit', (e)=>{
        e.preventDefault();
        if(socket.readyState!==WebSocket.OPEN){
            appendLog('[Error]', 'No active connection');
        }

        const message = input.value.trim();
        socket.send(message);
        appendLog('[Client Sent]', message);

        input.value = '';   
    })


</script>
</html>